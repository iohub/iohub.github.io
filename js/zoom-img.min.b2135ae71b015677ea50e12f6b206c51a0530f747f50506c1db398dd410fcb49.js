let scale=1,offset={left:0,top:0},origin="center",initialData={offset:{},origin:"center",scale:1},startPoint={x:0,y:0},isTouching=!1,isMove=!1,touches=new Map,lastDistance=0,lastScale=1,scaleOrigin={x:0,y:0},isPreview=!1,{innerWidth:winWidth,innerHeight:winHeight}=window,cloneEl=null,originalEl=null,mask=null,originalOffsetWidth=0,originalOffsetHeight=0,originalTop=0,originalLeft=0;for(let e of document.getElementsByClassName("data-image-info"))e.addEventListener("click",function(e){e.preventDefault(),e.target.classList.contains("data-image")&&(originalEl=e.target,cloneEl=originalEl.cloneNode(!0),originalEl.style.opacity=.3,openPreview())});function openPreview(){scale=1,isPreview=!0;const{offsetWidth:n,offsetHeight:i}=originalEl,{top:s,left:o}=originalEl.getBoundingClientRect();originalOffsetWidth=n,originalOffsetHeight=i,originalTop=s,originalLeft=o,mask=document.createElement("div"),mask.classList.add("modal"),document.body.appendChild(mask),mask.addEventListener("click",clickFunc),mask.addEventListener("mousewheel",zoom,{passive:!1}),changeStyle(cloneEl,[`left: ${o}px`,`top: ${s}px`,`position: absolute`,`width: ${n}px`]),mask.appendChild(cloneEl);const a={x:n/2+o,y:i/2+s},r={x:winWidth/2,y:winHeight/2},e={left:r.x-a.x+o,top:r.y-a.y+s},t={left:(adaptScale()-1)*n/2,top:(adaptScale()-1)*i/2};changeStyle(cloneEl,["transition: all 0.3s",`width: ${n*adaptScale()+"px"}`,`transform: translate(${e.left-o-t.left}px, ${e.top-s-t.top}px)`]),setTimeout(()=>{changeStyle(cloneEl,["transition: all 0s",`left: 0`,`top: 0`,`transform: translate(${e.left-t.left}px, ${e.top-t.top}px)`]),offset={left:e.left-t.left,top:e.top-t.top},record()},300)}function clickFunc(){setTimeout(()=>{isMove?isMove=!1:(changeStyle(cloneEl,["transition: all .3s",`left: ${originalLeft}px`,`top: ${originalTop}px`,`transform: translate(0,0)`,`width: ${originalOffsetWidth}px`]),setTimeout(()=>{try{document.body.removeChild(mask)}catch(e){console.log(e.message)}originalEl.style.opacity=1,mask.removeEventListener("click",clickFunc)},300),isPreview=!1)},280)}const zoom=e=>{if(!e.deltaY)return;e.preventDefault(),origin=`${e.offsetX}px ${e.offsetY}px`,e.deltaY<0?scale+=.1:e.deltaY>0&&scale>=.2&&(scale-=.1),scale<initialData.scale&&reduction(),offset=getOffsetCorrection(e.offsetX,e.offsetY),changeStyle(cloneEl,["transition: all .15s",`transform-origin: ${origin}`,`transform: translate(${offset.left+"px"}, ${offset.top+"px"}) scale(${scale})`])};function getOffsetCorrection(e=0,t=0){const n=Array.from(touches);if(n.length===2){const s=n[0][1],o=n[1][1];e=(s.offsetX+o.offsetX)/2,t=(s.offsetY+o.offsetY)/2}origin=`${e}px ${t}px`;const s=(scale-1)*(e-scaleOrigin.x)+offset.left,o=(scale-1)*(t-scaleOrigin.y)+offset.top;return scaleOrigin={x:e,y:t},{left:s,top:o}}window.addEventListener("pointerdown",function(e){isPreview&&(e.preventDefault(),touches.set(e.pointerId,e),isTouching=!0,startPoint={x:e.clientX,y:e.clientY},touches.size===2&&(lastDistance=getDistance(),lastScale=scale))}),window.addEventListener("pointerup",function(e){if(isPreview){if(touches.delete(e.pointerId),touches.size<=0)isTouching=!1;else{const e=Array.from(touches);startPoint={x:e[0][1].clientX,y:e[0][1].clientY}}setTimeout(()=>{isMove=!1},300)}}),window.addEventListener("pointermove",e=>{if(isPreview&&(e.preventDefault(),isTouching))if(isMove=!0,touches.size<2)offset={left:offset.left+(e.clientX-startPoint.x),top:offset.top+(e.clientY-startPoint.y)},changeStyle(cloneEl,["transition: all 0s",`transform: translate(${offset.left+"px"}, ${offset.top+"px"}) scale(${scale})`,`transform-origin: ${origin}`]),startPoint={x:e.clientX,y:e.clientY};else{touches.set(e.pointerId,e);const t=getDistance()/lastDistance;scale=t*lastScale,offset=getOffsetCorrection(),scale<initialData.scale&&reduction(),changeStyle(cloneEl,["transition: all 0s",`transform: translate(${offset.left+"px"}, ${offset.top+"px"}) scale(${scale})`,`transform-origin: ${origin}`])}}),window.addEventListener("pointercancel",function(){touches.clear()}),document.addEventListener("keydown",function(e){e.code==="Escape"&&isPreview&&clickFunc()});function changeStyle(e,t){const n=e.style.cssText.split(";");n.pop(),e.style.cssText=n.concat(t).join(";")+";"}function adaptScale(){const{offsetWidth:n,offsetHeight:t}=originalEl;let e=0;return e=winWidth/n,t*e>winHeight-80&&(e=(winHeight-80)/t),e}function getDistance(){const e=Array.from(touches);if(e.length<2)return 0;const t=e[0][1],n=e[1][1];return Math.hypot(n.x-t.x,n.y-t.y)}function record(){initialData=Object.assign({},{offset,origin,scale})}let timer=null;function reduction(){timer&&clearTimeout(timer),timer=setTimeout(()=>{offset=initialData.offset,origin=initialData.origin,scale=initialData.scale,changeStyle(cloneEl,[`transform: translate(${offset.left+"px"}, ${offset.top+"px"}) scale(${scale})`,`transform-origin: ${origin}`])},300)}